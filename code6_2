% M-file: mag_field.m
% M-file to calculate the net magnetic field produced by a three-phase stator.

clc; clear; close all;

% Basic conditions
bmax = 1;            % Normalized peak value
freq = 60;           % Frequency (Hz)
w = 2*pi*freq;       % Angular velocity (rad/s)

% Reduce frame count for faster plotting
numFrames = 200;  
t = linspace(0, 1/freq, numFrames);  % One full cycle

% Generate three-phase magnetic fields using complex representation
Baa = sin(w*t) .* exp(1j * 0);
Bbb = sin(w*t - 2*pi/3) .* exp(1j * 2*pi/3);
Bcc = sin(w*t + 2*pi/3) .* exp(1j * -2*pi/3);

% Resultant magnetic field
Bnet = Baa + Bbb + Bcc;

% Reference circle for visual comparison
circle = 1.5 * exp(1j * w*t);

% Plotting
figure;
for ii = 1:numFrames
    clf; % Clear figure for animation (can be optimized further if needed)
    hold on;
    
    % Reference circle
    plot(real(circle), imag(circle), 'k--'); 

    % Optional: show rotating phasor (Bloop) in green
    plot([0 cos(w*t(ii))], [0 sin(w*t(ii))], 'g', 'LineWidth', 2);

    % Net magnetic field vector in red
    plot([0 real(Bnet(ii))], [0 imag(Bnet(ii))], 'r', 'LineWidth', 3);

    % Axis settings
    axis square;
    axis([-2 2 -2 2]);
    xlabel('Real Axis');
    ylabel('Imaginary Axis');
    title('Rotating Magnetic Field - Three-Phase Stator');
    grid on;

    drawnow;
end
